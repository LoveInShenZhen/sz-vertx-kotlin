[原文链接](https://zhuanlan.zhihu.com/p/434112137)

# 交易柜台简介
依据国内监管要求，客户无法直连交易所系统，中间必须经过经纪公司的柜台系统，由经纪公司柜台系统调用交易所API下单。
交易柜台是连接交易所的下单系统。通过经纪公司交易柜台把交易指令发送到交易所，然后经纪公司交易柜台再将交易所委托回报和成交回报反馈给投资者。

很早听到国泰君安IT开发部的员工抱怨，说开发工作费脑子，但在公司里的地位还不如整天忙忙碌碌的运行维护部的同事。按理说，搞开发的，听上去蛮有技术含量的，怎么连普通的系统维护人员都不如，工资也低，奖金也低。

这里边的原因就在于，在证券公司内部，IT部的最核心的价值在于它维持了一套自动化交易系统，缺了这个系统，或者这个系统出现哪怕是一点点的故障，也会引起轩然大波。维护这个交易系统太重要了，领导太关注这个工作，领导的领导的眼里IT的价值也就是维护好这个交易系统的平稳运行，自然所以围绕这个工作的技术人员就会受到12分的重视，自然就能拿到高薪水。

这个系统就是今天要说的 **柜台交易系统**，每个证券公司的IT价值核心。

美国的第二大证券公司摩根士丹利曾经在2年前在中国大规模招聘IT开发人员，为其亚太地区的证券交易系统网罗劳工。说明一个现象：在国外的大投行里，其核心交易系统基本是自主开发。但在中国，柜台系统主要由两家开发商：杭州的恒生和深圳的金证（当然还有金士达、根网等等，但规模小多了；也有部分证券公司号称自己开发的交易系统，但或多或少的是与这两家公司“合作”完成的）。证券公司只需要花钱就能买来一整套的交易系统，由恒生和金证的工程师调好系统，按系统现有功能来开展业务就是了。

之前，大部分的证券公司的柜台系统是以营业部为基本单元的。就是说，每个营业部有自己独立的柜台服务器，电话委托、网上委托、银证转帐等等都是基于本营业部，几十个营业部各管各的，互不相关。现在基本都集中到公司总部。下边形象粗浅的描述一下这个核心的交易系统，给大家一个比较宏观而感性的印象。

在上海外高桥有一栋与上海交易所有密切利益关系的大楼，这栋大楼里有很多的空的机房出租，各个证券公司都在这里租用了很多房间，大部分的柜台交易核心服务器们就放置在这里。这种大楼往往被称为“IDC”互联网数据中心，专业的机房管理公司提供商业化的标准的机房和网罗环境，用户（证券公司们）每年花数百万人民币租用这里大小不等的机房。除了机房，IDC还提供普通的办公房间，供各公司管理各自机房的IT员工使用。所以，很多证券公司的柜台交易系统的维护人员实际上就在这栋大楼里上班。他们的跳槽也就是从这间房子跳到另一间房间里。

**柜台系统的核心服务器**是一台起码是价值100万以上的小型机服务器（相对PC服务器，小型机这个概念更高档一些和更贵一些），这些服务器一般都运行这Oracle9i数据库操作系统（也有用SQL2000的，显得更低档次一点），这个数据库内就是由恒生（或者金证）公司设计的数百张数据表格。

以下是券商柜台系统示意图：
![[Pasted image 20220331174847.png]]
# 券商柜台功能描述
券商柜台交易系统包括交易中心、登记托管中心、产品销售中心等组成部分，支持报价商、集合竞价、连续竞价等多样化交易模式，满足多种产品创设、登记、托管、销售、交易、清算等需求。

## 业务架构
业务支持系统包括发行转让管理与销售管理两大部分，涵盖对自有产品和外部产品的业务支撑。

## 发行转让管理
提供类似于登记公司、交易所的职能系统。主要承担自有产品的上柜推荐、登记存管、交易结算、市场监察、做市和经纪业务等职能。

## 销售管理
提供各业务产品主要的业务过程管理支撑。主要包括产品管理中心、销售过程管理、适当性、风险控制、财富管理等职能。

### 产品管理中心
柜台业务系统所有产品的运行、管理平台。从运行角度，主要管理与产品交易、销售有关的业务参数；从管理角度，需要全方位管理产品的详细资料，包括产品分类、产品引入、发行人管理、产品知识库、产品定价、产品评价、产品适当性等。

### 适当性管理
柜台业务系统的一个基础工作，通过严格的适当性管理，确保销售人员不向客户销售不适当的产品，从而在源头上杜绝因为不适当销售引起的系统性风险。

### 销售过程管理
可以对产品的销售提供全过程的支撑。包括销售任务管理、销售线索管理、销售额度管理、销售关系管理、业务支持等。

## 主要功能

### 托管结算
功能定位上主要参考目前中国登记结算公司的作用。行使账户注册登记、自产产品托管、资金交收的重要职能。

### 市场监察
主要包括盘中交易行为实时监控、事后报警、定期专项核查、超比例持股以及信息披露义务监管。市场监察系统通过实时监控、及时发现问题、及时制止、及时报告，做到有异动必有反应。

### 交易中心
在设计上参考目前国内证券市场如上海证券交易所、深圳证券交易所承担的角色，主要实现证券公司使用自行设计的交易制度在软件系统上的实现。

### 行情揭示系统
主要用于证券公司内部对场外市场业务品种的另版显示需求，建议可以通过顶点公司提供的行情揭示系统，在电视或其他现场硬件上显示场外市场业务品种行情信息。

### 交易管理平台
直接为投资者提供服务的基础订单系统，主要用于受理投资者所有场外业务相关请求。

### 做市商
针对当采用做市商或者报价商制度时，对做市商行驶权力及做市义务履行的管理，以及证券公司对做市商做市义务的监管等功能的实现。

### 经纪商
主要由经纪业务系统和股份公司管理系统组成。主要负责客户管理、资金管理、股份管理、行情揭示、委托管理和股份公司信息管理等。

# 券商柜台

## 券商柜台简介
依据国内监管要求，客户无法直连交易所系统，中间必须经过证券公司（Broker）的系统，即柜台系统。证券公司会有多套柜台系统，在功能上分为==集中交易柜台==和==快速交易柜台==。  

国内券商交易柜台厂商主要有恒生、金证、华锐、顶点、根网、金仕达、宽睿等公司，柜台系统功能模块根据付费多少而不同，也可以根据证券公司需求做开发，提供给投资者使用。普通交易柜台即集中交易柜台，主要是提供给一般投资者使用；针对机构客户等程序化交易客户，经纪公司同时提供了快速交易柜台。

主流券商系统（金证、恒生、金仕达）大致分为==报盘系统==、==接口数据库==、==柜台系统==三部分，程序化交易的接口通常是柜台系统提供的券商私有接口API和券商接口API两种。

==券商私有接口API==是提供给第三方金融软件公司的，第三方软件公司可以通过券商私有接口API开发出行情软件或交易软件，供给个人投资者使用，比如通达信，同花顺等。

==券商接口API==是指券商把其接口进行封装后，直接供给个人程序化投资者使用。

==报盘接口API==，一般是不可能供给个人用户使用的，只可能由券商系统提供商和其第三方合作伙伴共同开发。

## 集中交易柜台
集中交易柜台是券商的核心系统，用于对接上交所、深交所的股票交易，属于场内市场。

普通交易从进行委托开始，委托会先从投资者所在地到券商总部，再从券商总部到集中交易柜台，然后从集中交易柜台到交易所检查是否合规，如果判断合规，则从交易所传递信息返回集中交易柜台—券商总部，然后再下单，假设投资者在深圳，抛开审核时间，还要经历从深圳到券商总部，再到交易所的物理时间。

集中交易柜台是按照满足券商经纪业务来设计的，主要业务功能如下：
- ==账户业务==:  为客户进行账户开户、销户、管理业务权限、处理与交易相关的适当性管理、合规报送等。
- ==资金业务==: 支持客户保证金三方存管制度。
- ==证券交易业务==: 处理投资者提交的各类交易指令，按照交易规则进行资金和证券的处理，并实现与交易所的委托和成交指令的对接。
- ==信用交易业务==: 2010年证监会推出融资融券业务试点，投资者可以通过向证券公司融资买入股票，也可以融券卖出股票，实现了杠杆交易。系统需要按照信用交易的业务规则处理各类交易指令。
- ==基金代销业务==: 投资者可以通过证券账户购买开放式基金产品，系统处理投资者的产品申购赎回指令，并实现与相应基金公司的指令交互和资金、份额结算。
- ==清算业务==: 负责与交易所、登记结算公司进行数据交互和业务核对，完成客户在交易所内产品的资金、股份清算和结算。
- ==查询业务==: 满足客户需要的各种交易流水、对账单、交割单等业务数据。
- ==理财产品销售==: 券商为扩大客户投资品种范围，自行提供的各类理财产品的销售。
- ==现金余额理财业务==: 可将客户投资账户上的现金余额自动申购为货币基金，提高客户的资金收益。
- **其他管理职能**: 系统参数设置、客户账号安全、外围系统接入、异常交易监控等。

## 快速交易柜台
==快速交易柜台主要是为程序化交易客户提供的快速交易通道==，通常只提供基本的交易功能，力图实现低低延迟极速性能，==因此主流快速交易柜台的股票现货交易和信用交易是分开的==，因此需要分别进行接口开发。不同券商的快速交易柜台支持的交易功能有所不同，==但委托申报、委托回执、交易回执、撤单申报是基本功能==，==同时上海主板、上海科创板、深圳主板、深圳中小板、深圳创业板、可转债、逆回购时需要支持的基本业务品种==。

快速交易柜台在接到客户委托申报时会进行==风控合规检查==，只要过了风控就可以直接通过一条连接交易所的专线传递信息，无论是审核时间还是传输时间都得到了极大的缩短。

国内主要快速交易柜台系统包括华锐ATP快速交易柜台、恒生UFT快速交易柜台、恒生UST快速交易柜台、顶点HTS快速交易柜台、金证FGS快速交易柜台、宽睿OES快速交易柜台，华宝证券自研LTS交易柜台，中泰证券自研XTP交易柜台。

## OTC柜台
OTC柜台交易用于发行场外产品，开展个性化业务，属于==场外市场==。

柜台交易市场又叫OTC（==Over-The-Counter==）市场、场外交易市场或店头市场，是和交易所市场相对的一个概念。柜台交易市场主要采取一对一协商交易或报价、做市的交易方式，可交易多样化、个性化的产品。

OTC柜台交易系统是一种基于权威第三方行情作为报价依据，为交易商及投资者提供高效、安全、稳定系统服务，完善的后台管理功能模块，多级专业防护，确保系统安全，确保价格机制的稳定性与准确性，完善智能风控系统，保证交易安全。

柜台交易业务指证券公司与特定交易对手方在集中交易场所之外进行的交易或为投资者在集中交易场所之外进行交易提供服务的行为。

证券公司柜台交易市场明确定位于私募市场，是证券公司发行、转让、交易私募产品的平台。柜台交易市场建设初期配合资产管理业务创新，以销售和转让证券公司理财产品、代销金融产品为主。  

柜台交易客户以机构客户为主，各证券公司制定了相应的柜台交易适当性管理制度，根据不同产品制定了不同的投资者准入标准，并通过建立客户分类和产品风险评级制度，实现不同风险偏好的客户和不同风险级别的产品之间的匹配。

根据《证券公司柜台交易系统接口规范体系》的相关标准，中国证券业协会与中证资本市场发展监测中心有限责任公司制定相关指引，要求券商根据标准进行互联互通建设。

# 期货柜台

## 期货柜台简介
依据国内监管要求，客户无法直连交易所系统，中间必须经过期货公司（Broker）的系统，即柜台系统。期货公司会有多套柜台系统，在功能上分为主席和次席系统。

## 主席柜台
主席柜台功能全面，支持出入金、盘后结算等，要求高吞吐量与高可靠性，一般客户都是在主席系统上交易。

CTP (Comprehensive Transaction Platform，综合交易平台)是上期所子公司上期技术开发的一套主席系统。

## 次席柜台
次席系统一般只用于下单及撤单，重点是低延迟穿透时间，一般面向对时延要求较高的程序化交易客户。次席柜台的资金划拨、结算等功能则交由主席柜台实现。  

期货公司的极速交易系统是次席交易柜台，柜台内部穿透耗时峰值在百纳秒级，尤其适用于对延时要求严苛的交易团队。

## API
**在中国，任何柜台系统都必须调用交易所API才能下单。**

期货柜台系统一般都会提供API给程序化客户接入柜台使用，同时柜台系统需要调用交易所的API将用户的交易订单传输给交易所。

股指期货实现程序化交易最简便的是CTP。CTP提供了全开放的API接口，所以不论是个人还是第三方软件公司，都可以基于其API接口进行程序化交易系统的开发，但交易席位仍然要通过期货经纪公司。只要投资者选择一家以CTP为主交易系统的期货公司，利用CTP全开放的API接口，就可以开发自己的程序化交易系统。如果投资者的交易思想属于高频交易，对速度要求很高，就要选择CTP交易系统运维优良的，最好提供服务器托管服务的期货经纪公司。

## 交易所前置机
期货交易柜台需要通过交易所前置系统与交易所主机连接，前置系统是柜台与交易所撮合系统之间的通讯中继。  

交易所前置服务器不仅仅起到中间桥梁的作用，还要以通讯IP地址控制连入的终端，减少交易主机的网络负担的作用，以及对交易指令进行一部分的正确性检测处理。同时，还可以起到防火墙的功能，防止交易主机受到外界的攻击，确保交易主机的安全运行。  

为缓解交易系统压力，提高期货公司交易速度，交易所会设置多个交易前置机均衡前置机的系统负载，期货公司可按照交易所发布的前置机IP优选配置规则进行配置。

## 极速交易柜台
在中国期货市场，任何交易系统都必须调用交易所API（应用程序编程接口）才能下单。而国内交易所只提供软件版本API，而软件API只能通过CPU调用。
![[Pasted image 20220401144347.png]]
极速交易柜台拥有独立服务器的客户交易系统，使用独立的交易通道，优点在于委托速度快、申报指令推送快、成交回报快。

集中交易系统中，客户下单后通过网上客户端软件，先集中到网上交易服务器，再由网上服务器转向券商交易系统服务器，然后再接到交易所接口，最后再到交易所；极速交易通道，下单后转到快速交易通道与交易所系统对接。